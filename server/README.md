# Server

## Overview

The `server/` directory is the functional "brain" of Ultron. It is exposed as an express.js application, and internally runs a number of services to parse and execute requests. Here's a step-by-step guide:

1. Request hits endpoint in `index.js`, and is routed to the corresponding handler for the request.
2. `index.js` uses handlers defined in `endpoint/controller.js`. The `endpoint/` directory contains other files to assist in handling requests, including loggers and middleware.
3. `endpoint/controllers.js` will pass the transcript of the user's request to `intentParser/intentParser.js` which will break down the transcript and match it to an intent.
4. `intentParser.js` will then execute the matched intent and return the value to the controller in `endpoint/controllers.js`.
5. `controllers.js` will decode any errors in the intent's action, and pass the data to `loggers.js` to store any error data, as well as to log the conversation history in `out/` and the MongoDB endpoint.
6. `controllers.js` will return the JSON response generated by the intent to the user.

## Setup

To generate a working server on a new instance, you need the following files:

### .env
```
AIRTABLE_DREAM_API_KEY=
AIRTABLE_WORKOUT_API_KEY=
WHOIS_API_KEY=
KAPUR_KEY=
TESLA_TOKEN=
HOME_PASSWORD=
TEXT_KEY=
MONGO_DB_ULTRON_PASSWORD=
```

### keychain.json
```
{
  "api_key": "ipad",
  "api_key": "watch",
  "api_key": "macDev",
  "api_key": "phone",
  "api_key": "macProd",
  "api_key": "pi"
}
```

### mimic

Follow the instructions to rebuild [Mycroft's Mimic](https://mycroft-ai.gitbook.io/docs/mycroft-technologies/mimic-overview) service on the machine. This is the TTS engine.